---
title: Standards
description: Developer Standards & Patterns
---

# Developer Standards & Patterns

## Table Of Contents

<!-- Generated placeholder; add anchors as needed -->

## Table Of Contents

<!-- Generated placeholder; add anchors as needed -->

## Table Of Contents

<!-- Generated placeholder; add anchors as needed -->

**Version**: 1.0.0  
**Last Updated**: 2025-01-03  
**Status**: Current  
**Category**: Architecture  
**Purpose**: Comprehensive architectural standards for all projects in ~/Developer ecosystem

## ðŸ“‹ Table Of Contents

1. [Product Layout](#product-layout)
2. [Documentation and AI Guidance](#documentation-and-ai-guidance)
3. [Turborepo Standards](#turborepo-standards)
4. [AI Service Architecture](#ai-service-architecture)
5. [Apple Platform Standards](#apple-platform-standards)
6. [Common Patterns](#common-patterns)
7. [Quality Standards](#quality-standards)

## Product Layout

### 1. Monorepo (preferred) And Standalone (optional)

A product is organized primarily as a Turborepo monorepo. Standalone AI repos are optional for special cases:

- `[product-name]-xyz/`: The monorepo, managed with Turborepo and pnpm
  - `apps/app`: Main Next.js application
  - `apps/api`: API worker (Hono/Cloudflare) when needed
  - `apps/ai`: AI service app (preferred location for AI)
  - `packages/*`: Shared libraries (e.g., `api`, `database`, `design`, `ai`)
- `[product-name]-apple/` (optional): Native Apple platform project
- `[product-name]-docs/` (optional): Product-specific docs site (this hub remains general)

### 2. Naming Conventions

- **Web**: Use `-xyz` suffix (legacy: `-web` for sine)
- **AI**: Use `-ai` suffix
- **Apple**: Use `-apple` suffix
- **Docs**: Use `-docs` suffix

## Documentation And AI Guidance

### 1. Llm-specific Documentation

Key directories must contain documentation optimized for AI interpretation:

- **`CLAUDE.md`**: Required in project roots and major directories
- **`AGENTS.md`**: For AI-specific directories (e.g., `apps/api`, `src/mastra/agents`)
- **Purpose**: Provide high-level overview, architecture, patterns, and operational guidelines
- **Content**: Written as "system prompts" explaining the "why" behind the code

### 2. Code-level Documentation

- **TSDoc/JSDoc**: All exported functions, classes, and complex types must be documented
- **Required Tags**: `@param`, `@returns`, brief summary, `@example` (encouraged)
- **Focus**: Document intent and usage, not implementation details

### 3. Project Documentation Structure

```
[projectName]-docs/
â”œâ”€â”€ .docindex.json           # Machine-readable index for AI navigation
â”œâ”€â”€ README.md               # Comprehensive overview and navigation
â”œâ”€â”€ architecture/           # System design and decisions
â”œâ”€â”€ guides/                # How-to guides
â”‚   â”œâ”€â”€ deployment/
â”‚   â”œâ”€â”€ development/
â”‚   â””â”€â”€ setup/
â”œâ”€â”€ operations/            # DevOps and maintenance procedures
â”œâ”€â”€ planning/              # Roadmaps and proposals
â”œâ”€â”€ reference/             # API and technical reference
â””â”€â”€ archive/               # Historical documentation
```

## Turborepo Standards

### 1. Core Tooling And Dependencies

All `*-xyz` projects must use:

- **Package Manager**: `pnpm` (10.10.0+)
- **Language**: `TypeScript` (latest stable, strict mode enabled)
- **Framework**: `Next.js` (15+) with App Router
- **Formatter/Linter**: `Biome` (extends `ultracite`)
- **Node Version**: `>=20.9.0`

### 2. Monorepo Structure

```
[projectName]-xyz/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ app/              # Main Next.js user-facing application
â”‚   â””â”€â”€ api/              # Optional API service for webhooks/cron
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ analytics/        # PostHog wrapper
â”‚   â”œâ”€â”€ api/              # Business logic and domain services
â”‚   â”œâ”€â”€ auth/             # Clerk authentication wrapper
â”‚   â”œâ”€â”€ cache/            # Redis/caching utilities
â”‚   â”œâ”€â”€ database/         # Prisma client and schema
â”‚   â”œâ”€â”€ design/           # UI components and design system
â”‚   â”œâ”€â”€ email/            # React Email templates (if needed)
â”‚   â”œâ”€â”€ github/           # GitHub integration
â”‚   â”œâ”€â”€ logger/           # Structured logging
â”‚   â”œâ”€â”€ mastra/           # AI service client wrapper
â”‚   â”œâ”€â”€ next-config/      # Shared Next.js configuration
â”‚   â”œâ”€â”€ rate-limit/       # Rate limiting utilities
â”‚   â”œâ”€â”€ security/         # Security middleware
â”‚   â”œâ”€â”€ seo/              # SEO utilities
â”‚   â”œâ”€â”€ typescript-config/ # Shared TypeScript configs
â”‚   â””â”€â”€ webhooks/         # Webhook utilities
â”œâ”€â”€ biome.json
â”œâ”€â”€ package.json
â”œâ”€â”€ pnpm-workspace.yaml
â”œâ”€â”€ tsconfig.json
â””â”€â”€ turbo.json
```

### 3. Standard Scripts

```json
{
  "build": "turbo build",
  "dev": "turbo dev",
  "lint": "ultracite lint",
  "format": "ultracite format",
  "test": "turbo test",
  "analyze": "turbo analyze",
  "boundaries": "turbo boundaries",
  "bump-deps": "npx npm-check-updates --deep -u && pnpm install",
  "migrate": "cd packages/database && npx prisma format && npx prisma generate && npx prisma db push",
  "clean": "git clean -xdf node_modules"
}
```

### 4. Package Standards

- **Naming**: Internal packages use `@repo/[package-name]`
- **Protocol**: All internal dependencies use `workspace:*`
- **Exports**: Explicitly defined in package.json
- **Structure**: Each package has `src/` directory with `index.ts` entry

### 5. Authentication

- **Provider**: `Clerk` is mandatory
- **UI**: `Clerk Elements` for custom unstyled auth forms
- **Middleware**: Protect routes via middleware configuration

### 6. Ui And Styling

- **Styling**: `Tailwind CSS` v4 with CSS variables
- **Components**: `Radix UI` primitives + `shadcn/ui` patterns
- **Utilities**: `cva` for variants, `tailwind-merge` for class merging
- **Theme**: Glass morphism with blur effects and transparency

### 7. State Management

#### Client Ui State
- **Library**: `Jotai` for ephemeral client-side state
- **Organization**: Atoms in `apps/app/src/atoms/` by feature
- **Usage**: Modal states, UI toggles, menus

#### Server State
- **Library**: `SWR` for server state management
- **Pattern**: RSC hydration via `fallbackData`
- **Cache**: Automatic revalidation and optimistic updates

### 8. Database

- **ORM**: `Prisma` with PostgreSQL
- **Location**: Schema in `packages/database/prisma/schema.prisma`
- **Client**: Exported from `@repo/database`
- **Migrations**: Version controlled in `prisma/migrations/`

### 9. API And Data Flow

#### Primary Pattern: Server Actions
```typescript
// apps/app/src/actions/[domain].ts
"use server";

export async function createItem(input: CreateItemInput) {
  // 1. Validate with Zod
  const validated = createItemSchema.parse(input);
  
  // 2. Check authentication
  const { userId } = await auth();
  if (!userId) throw new Error("Unauthorized");
  
  // 3. Delegate to service layer
  const result = await itemService.create(userId, validated);
  
  // 4. Invalidate cache
  revalidatePath("/items");
  
  return result;
}
```

#### Secondary Pattern: Route Handlers
Only for:
- GET requests for client data fetching
- Third-party webhooks
- Service-to-service communication
- Health checks

#### Service Layer
All business logic in `packages/api/services/`:
```typescript
// packages/api/services/[domain].ts
export const itemService = {
  async create(userId: string, data: ValidatedData) {
    // Business logic here
    // Only services touch database
    return await db.item.create({...});
  }
};
```

## AI Service Architecture

### 1. Project Structure

```
apps/ai/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ mastra/
â”‚       â”œâ”€â”€ agents/       # Agent definitions
â”‚       â”‚   â””â”€â”€ [agent]/
â”‚       â”‚       â”œâ”€â”€ index.ts          # Agent configuration
â”‚       â”‚       â”œâ”€â”€ instructions.xml  # Structured prompts
â”‚       â”‚       â””â”€â”€ memory.ts         # Memory configuration
â”‚       â”œâ”€â”€ tools/        # Tool implementations
â”‚       â”œâ”€â”€ workflows/    # Multi-step processes
â”‚       â”œâ”€â”€ lib/         # Shared utilities
â”‚       â”‚   â””â”€â”€ attachments/
â”‚       â”‚       â”œâ”€â”€ embeddings.ts
â”‚       â”‚       â”œâ”€â”€ processor.ts
â”‚       â”‚       â””â”€â”€ rag.ts
â”‚       â””â”€â”€ index.ts     # Mastra instance
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ mcp/            # MCP tool configurations
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 2. Core Framework

- **Framework**: `@mastra/core` for all AI orchestration
- **Type**: ES modules (`"type": "module"`)
- **Scripts**: `mastra dev`, `mastra build`, `mastra start`

### 3. Model Initialization Pattern

```typescript
// Lazy initialization to prevent multiple instances
let model: ChatModel | null = null;

export function getChatModel() {
  if (!model) {
    model = anthropic.chat("claude-3-5-sonnet");
  }
  return model;
}
```

### 4. Agent Instructions Format

```xml
<agent_instructions>
  <purpose>Concise statement of agent's role</purpose>
  
  <capabilities>
    <capability>Specific action 1</capability>
    <capability>Specific action 2</capability>
  </capabilities>
  
  <methodology>
    <step>Analyze request</step>
    <step>Plan approach</step>
    <step>Execute solution</step>
    <step>Summarize results</step>
  </methodology>
  
  <guidelines>
    <guideline>Behavioral rule 1</guideline>
    <guideline>Behavioral rule 2</guideline>
  </guidelines>
  
  <response_examples>
    <example>
      <query>Example user query</query>
      <response>Example agent response</response>
    </example>
  </response_examples>
  
  <include>tools/mcp/github.xml</include>
</agent_instructions>
```

### 5. Storage And Memory

- **Database**: Same PostgreSQL instance as web app
- **Storage**: `@mastra/pg` for PostgresStore and PgVector
- **Pattern**: Shared storage instances to minimize connections

## Apple Platform Standards

### 1. Project Structure

```
[projectName]-apple/
â”œâ”€â”€ Packages/              # Local Swift packages
â”‚   â”œâ”€â”€ Auth/             # Clerk authentication
â”‚   â”œâ”€â”€ Design/           # SwiftUI design system
â”‚   â”œâ”€â”€ [Name]Networking/ # API client
â”‚   â””â”€â”€ Analytics/        # Event tracking
â”œâ”€â”€ [projectName]-ios/     # Main iOS app
â”‚   â”œâ”€â”€ Assets.xcassets/
â”‚   â”œâ”€â”€ Resources/
â”‚   â”‚   â””â”€â”€ Fonts/
â”‚   â”œâ”€â”€ Views/            # SwiftUI views
â”‚   â”œâ”€â”€ ViewModels/       # MVVM view models
â”‚   â”œâ”€â”€ Services/         # Business logic
â”‚   â”œâ”€â”€ Managers/         # Singletons
â”‚   â””â”€â”€ Models/           # Data models
â””â”€â”€ [projectName].xcodeproj
```

### 2. Swift Package Structure

```swift
// Package.swift
let package = Package(
    name: "PackageName",
    platforms: [.iOS(.v17), .macOS(.v14)],
    products: [
        .library(name: "PackageName", targets: ["PackageName"])
    ],
    dependencies: [
        // External dependencies
    ],
    targets: [
        .target(
            name: "PackageName",
            dependencies: [],
            path: "Sources"
        ),
        .testTarget(
            name: "PackageNameTests",
            dependencies: ["PackageName"],
            path: "Tests"
        )
    ]
)
```

### 3. Architecture Patterns

#### Mvvm Pattern
- **View**: SwiftUI views, lightweight presentation only
- **ViewModel**: ObservableObject managing view state
- **Model**: Simple structs, Codable and Identifiable

#### Dependency Injection
```swift
// Centralized container
class AppDependencies {
    static let shared = AppDependencies()
    
    lazy var networkManager = NetworkManager()
    lazy var authService = AuthService()
    // ... other services
}

// Injected via environment
.environmentObject(AppDependencies.shared)
```

#### Service Layer
- Business logic in service classes
- Protocol-oriented design
- ViewModels depend on protocols, not implementations

### 4. UI/UX patterns

#### Glass Morphism Design
- **Base**: `ultraThinMaterial` blur effect
- **Enhancement**: Custom gradients and borders
- **Package**: `Glur` for advanced blur effects
- **Implementation**: `VariableBlurView` for dynamic blurs

#### Haptic Feedback
```swift
// Centralized semantic haptics
class HapticManager {
    static let shared = HapticManager()
    
    func tap(_ action: PrimaryAction) {
        // Maps semantic actions to haptic patterns
    }
}
```

#### Navigation
- **Transitions**: Custom, physics-based animations
- **Gestures**: Edge-swipe for dismissal
- **Springs**: All animations use spring physics

### 5. Networking Layer

#### Actor-based Architecture
```swift
actor NetworkManager {
    // Thread-safe network operations
    private var activeTasks: [URL: Task<Data, Error>] = [:]
    
    func fetch<T: Decodable>(_ endpoint: Endpoint) async throws -> T {
        // Request coalescing
        // Response caching
        // Interceptor chain
    }
}
```

#### Core Features
1. **Type-Safe Endpoints**: Strongly typed enum/struct
2. **Request Coalescing**: Prevent duplicate requests
3. **Response Caching**: Actor-based cache with policies
4. **Interceptor Chain**: Auth, logging, retry logic

## Common Patterns

### 1. Error Handling

```typescript
// Web projects
export class ApiError extends Error {
  constructor(
    message: string,
    public code: string,
    public statusCode: number = 400
  ) {
    super(message);
  }
}

// Consistent error responses
export function errorResponse(error: ApiError) {
  return NextResponse.json(
    { error: error.message, code: error.code },
    { status: error.statusCode }
  );
}
```

### 2. Authentication Pattern

```typescript
// Server-side auth check
import { auth } from "@repo/auth/server";

export async function protectedAction() {
  const { userId } = await auth();
  if (!userId) {
    throw new ApiError("Unauthorized", "UNAUTHORIZED", 401);
  }
  // ... continue
}
```

### 3. Validation Pattern

```typescript
// Zod schemas with inference
import { z } from "zod";

export const createItemSchema = z.object({
  name: z.string().min(1).max(100),
  description: z.string().optional(),
});

export type CreateItemInput = z.infer<typeof createItemSchema>;
```

### 4. Component Patterns

```typescript
// shadcn/ui pattern with cva
import { cva, type VariantProps } from "class-variance-authority";
import { cn } from "@repo/design/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center...",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground",
        destructive: "bg-destructive text-destructive-foreground",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 px-3",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {}
```

### 5. File Naming Conventions

- **Files/Directories**: `kebab-case`
- **Components**: `PascalCase.tsx`
- **Utilities**: `camelCase.ts`
- **Constants**: `UPPER_SNAKE_CASE`
- **Types/Interfaces**: `PascalCase`

## Quality Standards

### Before Committing

- [ ] TypeScript compiles without errors
- [ ] Biome formatting applied (`pnpm format`)
- [ ] No `console.log` statements
- [ ] Error boundaries implemented
- [ ] Loading states handled
- [ ] Mobile responsive design
- [ ] Accessibility checked (keyboard nav, ARIA)
- [ ] Documentation updated (CLAUDE.md if needed)

### Testing Requirements

- **Unit Tests**: Vitest for business logic
- **Integration**: Test critical user flows
- **AI Tests**: Custom Mastra test harness
- **Coverage**: Aim for 80% on critical paths

### Performance Standards

- **Bundle Size**: Monitor with `turbo analyze`
- **Core Web Vitals**: LCP < 2.5s, FID < 100ms, CLS < 0.1
- **Images**: Optimized with Next.js Image
- **Fonts**: System fonts or optimized web fonts

### Security Standards

- **Environment Variables**: Never commit secrets
- **API Keys**: Use environment variables with `NEXT_PUBLIC_` prefix for client
- **Authentication**: Always verify on server side
- **Input Validation**: Validate all user input with Zod
- **SQL Injection**: Use Prisma parameterized queries

## Related

- [Architecture overview](/architecture/overview)
- [Turborepo](/tools/stack/turborepo)
- [AI SDK](/tools/stack/ai-sdk)
- [Next.js](/tools/stack/nextjs)
- [Tailwind CSS](/tools/stack/tailwind)
- [TypeScript](/tools/stack/typescript)
- [Auth (Clerk)](/tools/stack/clerk)
- [Server state (SWR)](/tools/stack/swr)
- [Client state (Jotai)](/tools/stack/jotai)

---

*This document represents the actual implemented standards across all projects. Updates should reflect real pattern changes, not aspirational features.*

## See Also

- [Turborepo](/tools/stack/turborepo)
- [AI Sdk](/tools/stack/ai-sdk)
- [Orpc Turborepo Guide](/tools/integrations/orpc-turborepo-guide)
